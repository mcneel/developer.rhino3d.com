{{ $url := "" }}
{{ $alt := "" }}
{{ $class := "" }}
{{ $width := "" }}
{{ $height := "" }}
{{ if .IsNamedParams }}
    {{ if .Get "url" }}{{ $url = .Get "url" }}{{ end }}
    {{ if .Get "alt" }}{{ $alt = .Get "alt" }}{{ end }}
    {{ if .Get "class"}}{{ $class = .Get "class" }}{{ end }}
    {{ if .Get "width"}}{{ $width = .Get "width" }}{{ end }}
    {{ if .Get "height"}}{{ $height = .Get "height" }}{{ end }}
{{ else }}
    {{ $url = .Get 0 }}
    {{ if .Get 1 }}{{ $class = .Get 1 }}{{ end }}
{{ end }}

{{- $image_url := "" -}}
{{ if hasPrefix $url "/images/"}}
    {{- if eq hugo.Environment "development" -}}
        {{- $image_url = ($url | relURL ) -}}
    {{- else -}}
        {{- $image_url = (print .Site.Params.baseURLForFigures $url) -}}
    {{- end -}}
{{- else if hasPrefix $url ".." -}}
    {{- $image_url = $url -}}
{{- else if hasPrefix $url "http" -}}
    {{- $image_url = $url -}}
{{- else -}}
    {{- $res := .Page.Resources.GetMatch ( printf "%s" $url) -}}
    {{- if not $res -}}
        {{- $defaultPage := .Site.GetPage (printf "%s/%s" .Page.Section .Page.File.TranslationBaseName) -}}
        {{- if $defaultPage -}}
            {{- $res = $defaultPage.Resources.GetMatch ( printf "%s" $url) -}}
        {{- end -}}
    {{- end -}}
    {{- if $res -}}
        {{- $image_url = $res.RelPermalink -}}
    {{- else -}}
        {{- $image_url = (print "/images/" $url) -}}
    {{- end -}}
{{- end -}}

<img src="{{ $image_url }}" alt="{{ $alt }}" class="{{ $class }}" width="{{ $width }}" height="{{ $height }}">
